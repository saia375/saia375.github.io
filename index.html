<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æˆ‘çš„æ¯æ—¥å°ç¢ºå¹¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Playfair+Display:ital,wght@0,400..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* å…¨åŸŸè¨­å®šï¼Œç§»é™¤åœ“è§’ */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Lora', serif;
      background: #fafafa;
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }
    .hero-img {
      width: 100%;
      height: auto;
      max-height: 40vh;
      object-fit: cover;
      margin-bottom: 40px;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 3.5em;
      text-align: center;
      margin-bottom: 40px;
      color: #333;
    }

    /* ç¯©é¸æŒ‰éˆ•åˆ—æ¨£å¼ */
    .filter-bar {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 50px;
    }
    .filter-bar button {
      padding: 8px 15px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      font-family: 'Lora', serif;
      font-size: 1.1em;
      transition: all 0.2s ease-in-out;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .filter-bar button:hover, .filter-bar .active {
      background-color: #f0f0f0;
      color: #000;
      border-color: #000;
    }

    /* æ–‡ç« å¡ç‰‡ç¶²æ ¼ */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      box-shadow: none;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      height: auto;
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
      position: relative;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    .card img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      margin-bottom: 15px;
    }
    .card .content {
      padding: 0;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }
    .card .content h3 {
      font-family: 'Playfair Display', serif;
      font-size: 2em;
      margin-bottom: 10px;
      color: #333;
    }
    .card .content p {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: #555;
    }
    .read-more {
      display: inline-block;
      padding: 0;
      background: none;
      border: none;
      color: #000;
      text-decoration: underline;
      cursor: pointer;
      transition: color 0.2s;
      font-family: 'Lora', serif;
      font-size: 1.1em;
      text-align: left;
    }
    .read-more:hover {
      color: #888;
      background: none;
    }
    .hidden { display: none; }
    /* é¡¯ç¤ºåœ¨å¡ç‰‡å³ä¸‹è§’çš„æ„›å¿ƒæ•¸ */
    .likes-info {
      position: absolute;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 1.1rem;
      color: #888;
    }
    /* å¡ç‰‡ä¸Šçš„æ„›å¿ƒæŒ‰éˆ• */
    .card-like-button {
      background: none;
      border: none;
      font-size: 1.1rem;
      color: #ccc;
      cursor: pointer;
      padding: 0;
    }
    .card-like-button.liked { color: #e55; }
    .card-like-button.author-liked { color: #e55; }
    .card-like-button:disabled { cursor: not-allowed; }
    .card-likes-count {
      font-size: 1.1rem;
      color: #888;
    }

    /* å–®ç¯‡æ–‡ç« æ¨£å¼ */
    .full-article {
      font-size: 1.1rem;
      background: white;
      padding: 40px;
      border: 1px solid #eee;
      max-width: 800px;
      margin: 0 auto;
    }
    .full-article h2 {
      font-family: 'Playfair Display', serif;
      font-size: 3em;
      margin-bottom: 10px;
    }
    .back-btn {
      margin-top: 30px;
      display: inline-block;
      color: #888;
      cursor: pointer;
      text-decoration: none;
      font-family: 'Lora', serif;
    }
    .back-btn:hover {
      text-decoration: underline;
    }

    /* ç•™è¨€å€æ¨£å¼ */
    .comment-form {
      display: flex;
      flex-direction: column;
      margin-top: 30px;
    }
    #comment-input, #comment-nickname {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 0;
      font-family: 'Lora', serif;
      font-size: 1.1rem;
      color: #333;
    }
    #comment-nickname:disabled {
      background-color: #f0f0f0;
      cursor: not-allowed;
    }
    #submit-comment {
      align-self: flex-start;
      padding: 10px 20px;
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
      font-family: 'Lora', serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    #submit-comment:hover {
      background-color: #555;
    }
    .comment-list { padding: 0; }
    .comment-item {
        border-bottom: 1px solid #eee;
        padding: 15px 0;
    }
    .comment-item.reply {
        margin-left: 20px;
        padding-left: 20px;
        border-left: 2px solid #ddd;
    }
    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 5px;
    }
    .comment-info {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }
    .comment-text { font-size: 1.1rem; margin: 5px 0; }
    .comment-item small {
      display: block;
      text-align: left;
      color: #888;
    }
    .comment-actions {
      display: flex;
      gap: 10px;
      margin-left: auto;
    }
    /* â¬‡ï¸ æ–°å¢ï¼šåœ–ç¤ºæŒ‰éˆ•æ¨£å¼ */
    .comment-actions button {
      padding: 5px; /* èª¿æ•´å…§è· */
      border: none;
      background-color: transparent;
      color: #888;
      cursor: pointer;
      font-size: 1rem;
      transition: color 0.2s;
    }
    .comment-actions button:hover {
        color: #333;
        background-color: #f0f0f0;
    }
    .comment-actions button i {
        pointer-events: none; /* é˜²æ­¢é»æ“Šåœ–ç¤ºæ™‚è§¸ç™¼å…©æ¬¡ */
    }

    .edit-textarea {
      width: 100%;
      padding: 5px;
      font-family: 'Lora', serif;
      font-size: 1.1rem;
      border: 1px solid #ccc;
      border-radius: 0;
      margin-top: 5px;
    }
    .edit-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .edit-actions button {
      padding: 8px 15px;
      border: 1px solid #ccc;
      background-color: white;
      color: #333;
      font-size: 1rem;
      cursor: pointer;
      font-family: 'Lora', serif;
    }
    .edit-actions .save-btn { background-color: #333; color: white; }
    .edit-actions .save-btn:hover { background-color: #555; }
    .edit-actions .cancel-btn:hover { background-color: #eee; }

    .user-selector {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      padding: 20px;
      font-family: 'Lora', serif;
    }

    .like-button-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
    .like-button {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #ccc;
      transition: color 0.2s;
    }
    .like-button:hover { color: #e55; }
    .like-button.liked { color: #e55; }
    .like-button.author-liked { color: #e55; }
    .like-button:disabled { cursor: not-allowed; }

    .reply-form {
        display: none;
        flex-direction: column;
        margin-top: 10px;
        margin-left: 20px;
        padding-left: 20px;
        border-left: 2px solid #ddd;
    }
    .reply-form.active { display: flex; }
    .reply-form-input, .reply-form-nickname {
        width: 100%;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #ccc;
        font-family: 'Lora', serif;
        font-size: 1rem;
    }
    .reply-form-nickname:disabled { background-color: #f0f0f0; cursor: not-allowed; }
    .reply-form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }
    .reply-form-actions button {
        padding: 6px 12px;
        border: none;
        cursor: pointer;
        font-family: 'Lora', serif;
    }
    .reply-submit-btn { background-color: #333; color: white; }
    .reply-cancel-btn { background-color: #ccc; color: #333; }
  </style>
</head>
<body>
  <div class="user-selector">
    <span>ç•¶å‰èº«ä»½ï¼š<strong id="current-user-name">éƒ¨è½æ ¼ä½œè€…</strong></span>
    <button id="author-btn" data-id="author">éƒ¨è½æ ¼ä½œè€…</button>
    <button id="guest1-btn" data-id="guest1">éŠå®¢ 1</button>
    <button id="guest2-btn" data-id="guest2">éŠå®¢ 2</button>
  </div>

  <img src="https://picsum.photos/id/777/1200/400" alt="æ©«å¹…åœ–ç‰‡" class="hero-img" loading="lazy" />
  <h1>æˆ‘çš„æ¯æ—¥å°ç¢ºå¹¸</h1>

  <div class="filter-bar">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="life">Life</button>
    <button class="filter-btn" data-filter="travel">Travel</button>
    <button class="filter-btn" data-filter="food">Food</button>
  </div>

  <div class="grid" id="postGrid">
    </div>

  <div id="fullArticle" class="full-article hidden">
    <img id="articleImage" src="" alt="æ–‡ç« åœ–ç‰‡" style="width: 100%; height: auto; max-height: 300px; object-fit: cover; margin-bottom: 30px;" />
    <h2 id="articleTitle">æ¨™é¡Œ</h2>
    <small id="articleDate" style="color: #888; display: block; margin: 15px 0 20px; font-style: italic;"></small>
    <p id="articleContent">å®Œæ•´å…§å®¹å°‡åœ¨é€™é¡¯ç¤º</p>
    <div class="like-button-container">
      <button id="like-button" class="like-button"><i class="fas fa-heart"></i></button>
      <span id="like-count">0</span>
    </div>
    <div class="back-btn" onclick="backToList()">â† è¿”å›åˆ—è¡¨</div>
    <hr style="margin: 30px 0;">
    <h3>ç•™è¨€</h3>
    <div id="comments-container">
    </div>
    <div class="comment-form">
      <input type="text" id="comment-nickname" placeholder="æ‚¨çš„æš±ç¨±ï¼ˆé¸å¡«ï¼‰" />
      <textarea id="comment-input" placeholder="ç•™ä¸‹æ‚¨çš„æƒ³æ³•..." rows="4"></textarea>
      <button id="submit-comment">é€å‡º</button>
    </div>
  </div>

  <script>
    const posts = [
      {
        id: 1,
        category: 'life',
        title: 'æº«é¦¨å®¶åº­æ—©æ™¨',
        summary: 'äº«å—é™½å…‰èˆ‡å­©å­çš„ç¬‘è²ï¼Œæ˜¯ä¸€å¤©æœ€ç¾çš„é–‹å§‹ã€‚',
        content: 'ä»Šå¤©ä¸€æ—©é†’ä¾†ï¼Œé™½å…‰ç‘é€²çª—é‚Šï¼Œå­©å­å€‘ç¬‘é¬§è²å¾å»šæˆ¿å‚³ä¾†ï¼Œç©ºæ°£ä¸­é£„è‘—ç…è›‹é¦™å‘³ã€‚ç°¡å–®çš„ç”Ÿæ´»ç‰‡æ®µï¼Œå»æœ‰è‘—ç„¡é™çš„å¹¸ç¦ã€‚ Lorem ipsum dolor sit amet consectetur, adipisicing elit. Unde eum, ipsam vel nemo ad eveniet magnam quibusdam. Nobis voluptatem est ut neque corrupti amet cum expedita laborum voluptatibus saepe nulla iure odio quia eveniet officiis qui eum ab incidunt, quis illo rerum suscipit harum a autem eaque. Excepturi corporis illum necessitatibus rem inventore ipsum consequuntur voluptatibus voluptatum dolorem, iste laboriosam saepe explicabo odit eaque dolores odio nam provident delectus amet cum asperiores. Voluptatum voluptas, expedita error totam quam in cum, ex saepe delectus porro debitis tempore blanditiis sequi commodi eveniet repellat deserunt esse fuga nostrum a ea. Sit, molestias, numquam.',
        image: 'images/a1.jpg',
        date: '2025-08-01',
        likes: 0
      },
      {
        id: 2,
        category: 'travel',
        title: 'å±±é–“å°æ—…è¡Œ',
        summary: 'èœ¿èœ’å°å¾‘èˆ‡é³¥é³´è²ï¼Œæ²»ç™’æ¯å€‹ç–²æ†Šçš„å¿ƒéˆã€‚',
        content: 'æˆ‘å€‘èµ°åœ¨ç¶ æ„ç›ç„¶çš„å°å¾‘ä¸­ï¼Œé é›¢å¡µå›‚ã€‚æºªæ°´æ½ºæ½ºï¼Œç©ºæ°£æ¸…æ–°ï¼Œæ¯ä¸€æ­¥éƒ½åƒæ˜¯åœ¨ä¿®å¾©è‡ªå·±ã€‚é€™ä¸€è¶Ÿæ—…ç¨‹ï¼Œè®“æˆ‘é‡æ–°æ‰¾å›å¹³éœçš„åŠ›é‡ã€‚ Lorem ipsum dolor sit amet consectetur, adipisicing elit. Unde eum, ipsam vel nemo ad eveniet magnam quibusdam. Nobis voluptatem est ut neque corrupti amet cum expedita laborum voluptatibus saepe nulla iure quia eveniet officiis qui eum ab incidunt, quis illo rerum suscipit harum a autem eaque. Excepturi corporis illum necessitatibus rem inventore ipsum consequuntur voluptatibus voluptatum dolorem, iste laboriosam saepe explicabo odit eaque dolores odio nam provident delectus amet cum asperiores. Voluptatum voluptas, expedita error totam quam in cum, ex saepe delectus porro debitis tempore blanditiis sequi commodi eveniet repellat deserunt esse fuga nostrum a ea. Sit, molestias, numquam.',
        image: 'images/a2.jpg',
        date: '2025-08-04',
        likes: 0
      },
      {
        id: 3,
        category: 'food',
        title: 'çƒ¤é¦™è•‰é¬†é¤…',
        summary: 'é¦™è•‰èˆ‡æ ¸æ¡ƒäº¤ç¹”å‡ºçš„ç™‚ç™’æ»‹å‘³ã€‚',
        content: 'å°‡ç†Ÿé€çš„é¦™è•‰æ—ç¢èˆ‡éºµç³Šæ··åˆï¼Œæ’’ä¸Šæ ¸æ¡ƒï¼Œæ”¾å…¥çƒ¤ç®±ï¼Œé£„å‡ºç”œç”œé¦™æ°£ã€‚é€™æ˜¯æˆ‘æœ€æ„›çš„ä¸‹åˆé»å¿ƒï¼Œé…ä¸Šä¸€æ¯ç‰›å¥¶ï¼Œå‰›å‰›å¥½ã€‚Lorem ipsum dolor sit amet consectetur, adipisicing elit. Unde eum, ipsam vel nemo ad eveniet magnam quibusdam. Nobis voluptatem est ut neque corrupti amet cum expedita laborum voluptatibus saepe nulla iure odio quia eveniet officiis qui eum ab incidunt, quis illo rerum suscipit harum a autem eaque. Excepturi corporis illum necessitatibus rem inventore ipsum consequuntur voluptatibus voluptatum dolorem, iste laboriosam saepe explicabo odit eaque dolores odio nam provident delectus amet cum asperiores. Voluptatum voluptas, expedita error totam quam in cum, ex saepe delectus porro debitis tempore blanditiis sequi commodi eveniet repellat deserunt esse fuga nostrum a ea. Sit, molestias, numquam.',
        image: 'images/a3.jpg',
        date: '2025-09-02',
        likes: 0
      },
      {
        id: 4,
        category: 'life',
        title: 'å¤œæ™šçš„éœè¬é–±è®€',
        summary: 'æŸ”å…‰ä¹‹ä¸‹ï¼Œæ–‡å­—èˆ‡æ€ç·’ä¸€åŒæµå‹•ã€‚',
        content: 'æ™šä¸Šç¸½å–œæ­¡é—œæ‰æ‰‹æ©Ÿï¼Œæ³¡æ¯èŒ¶ï¼Œè®“è‡ªå·±æ²‰æµ¸åœ¨æ›¸ä¸­çš„ä¸–ç•Œï¼Œæ„Ÿå—ä¸€ç¨®å±¬æ–¼è‡ªå·±çš„å¹³éœã€‚ Lorem ipsum dolor sit amet consectetur, adipisicing elit. Unde eum, ipsam vel nemo ad eveniet magnam quibusdam. Nobis voluptatem est ut neque corrupti amet cum expedita laborum voluptatibus saepe nulla iure odio quia eveniet officiis qui eum ab incidunt, quis illo rerum suscipit harum a autem eaque. Excepturi corporis illum necessitatibus rem inventore ipsum consequuntur voluptatibus voluptatum dolorem, iste laboriosam saepe explicabo odit eaque dolores odio nam provident delectus amet cum asperiores. Voluptatum voluptas, expedita error totam quam in cum, ex saepe delectus porro debitis tempore blanditiis sequi commodi eveniet repellat deserunt esse fuga nostrum a ea. Sit, molestias, numquam.',
        image: 'images/a4.jpg',
        date: '2025-10-15',
        likes: 0
      }
    ];

    const users = {
      'guest1': { id: 'guest1', nickname: 'éŠå®¢ 1' },
      'guest2': { id: 'guest2', nickname: 'éŠå®¢ 2' },
      'author': { id: 'author', nickname: 'éƒ¨è½æ ¼ä½œè€…' },
      'anonymous': { id: 'anonymous', nickname: 'åŒ¿åéŠå®¢' },
    };
    
    let currentUser = users.author;
    let likedPosts = JSON.parse(localStorage.getItem('likedPosts')) || {};
    let allPostsLikes = JSON.parse(localStorage.getItem('allPostsLikes')) || {};

    // åˆå§‹åŒ–æ¯ç¯‡æ–‡ç« çš„æŒ‰è®šæ•¸
    posts.forEach(post => {
      if (allPostsLikes[post.id] === undefined) {
        allPostsLikes[post.id] = 0;
      }
      post.likes = allPostsLikes[post.id];
    });

    const grid = document.getElementById('postGrid');
    const articleSection = document.getElementById('fullArticle');
    const articleTitle = document.getElementById('articleTitle');
    const articleContent = document.getElementById('articleContent');
    const articleDate = document.getElementById('articleDate');

    // ä½¿ç”¨è€…èº«ä»½åˆ‡æ›åŠŸèƒ½
    document.querySelectorAll('.user-selector button').forEach(button => {
        button.addEventListener('click', () => {
            const userId = button.dataset.id;
            currentUser = users[userId];
            
            document.getElementById('current-user-name').innerText = currentUser.nickname;
            alert(`ä½ ç¾åœ¨æ˜¯ï¼š${currentUser.nickname}`);
            
            const currentPostId = document.getElementById('submit-comment').dataset.postId;
            if (currentPostId) {
                renderComments(currentPostId);
                updateLikeButtonState(currentPostId);
            }
            
            const nicknameInput = document.getElementById('comment-nickname');
            if (currentUser.id === 'author') {
              nicknameInput.value = 'éƒ¨è½æ ¼ä½œè€…';
              nicknameInput.disabled = true;
            } else {
              nicknameInput.value = '';
              nicknameInput.disabled = false;
            }
            renderCards();
        });
    });

    // â¬ å‹•æ…‹å»ºç«‹å¡ç‰‡
    function renderCards() {
      grid.innerHTML = '';
      posts.forEach(post => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.category = post.category;
        card.dataset.id = post.id;
        
        const isLiked = likedPosts[currentUser.id] && likedPosts[currentUser.id][post.id];
        let likedClass = '';
        if (currentUser.id === 'author') {
            likedClass = 'author-liked';
        } else if (isLiked) {
            likedClass = 'liked';
        }
        const disabledAttr = currentUser.id === 'author' ? 'disabled' : '';

        card.innerHTML = `
          <img src="${post.image}" alt="æ–‡ç« åœ–ç‰‡">
          <div class="content">
            <small>${post.date}</small>
            <h3>${post.title}</h3>
            <p>${post.summary}</p>
            <button class="read-more" data-id="${post.id}">é–±è®€æ›´å¤š â†’</button>
          </div>
          <div class="likes-info">
            <button class="card-like-button ${likedClass}" data-id="${post.id}" ${disabledAttr}>
              <i class="fas fa-heart"></i>
            </button>
            <span class="card-likes-count">${post.likes}</span>
          </div>
        `;
        grid.appendChild(card);
      });

      document.querySelectorAll('.card-like-button').forEach(button => {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const postId = e.currentTarget.dataset.id;
          toggleLike(postId);
        });
      });
    }

    // â³ é»æ“Šé–±è®€æ›´å¤š
    document.addEventListener('click', function (e) {
      if (e.target.classList.contains('read-more')) {
        const id = e.target.dataset.id;
        const post = posts.find(p => p.id == id);
        articleTitle.innerText = post.title;
        articleContent.innerText = post.content;
        articleImage.src = post.image;
        articleDate.innerText = post.date;
        grid.classList.add('hidden');
        articleSection.classList.remove('hidden');
        window.scrollTo(0, 0);

        document.getElementById('comments-container').innerHTML = '';
        renderComments(id);
        document.getElementById('submit-comment').dataset.postId = id;
        
        document.getElementById('like-count').innerText = post.likes;
        updateLikeButtonState(id);
      }
    });

    // â†©ï¸ è¿”å›åˆ—è¡¨
    function backToList() {
      articleSection.classList.add('hidden');
      grid.classList.remove('hidden');
      renderCards();
    }

    // é¡¯ç¤ºç‰¹å®šæ–‡ç« çš„ç•™è¨€
    function renderComments(postId) {
      const container = document.getElementById('comments-container');
      const postComments = comments[postId];
      container.innerHTML = '';

      if (postComments && postComments.length > 0) {
        postComments.forEach((comment, index) => {
          const commentDiv = renderCommentItem(comment, index, postId);
          container.appendChild(commentDiv);
        });
      } else {
        container.innerHTML = '<p style="color: #888; font-style: italic;">ç›®å‰æ²’æœ‰ç•™è¨€ï¼Œä¾†ç•¶ç¬¬ä¸€ä½å§ï¼</p>';
      }
      
      addCommentEventListeners(postId);
    }
    
    // æ¸²æŸ“å–®ä¸€ç•™è¨€ï¼ˆæˆ–å›è¦†ï¼‰çš„å‡½å¼
    function renderCommentItem(comment, index, postId, isReply = false, replyIndex = null) {
        const commentDiv = document.createElement('div');
        commentDiv.className = `comment-item ${isReply ? 'reply' : ''}`;

        let actionButtons = '';
        // åªæœ‰ç•™è¨€è€…è‡ªå·±èƒ½ç·¨è¼¯
        if (comment.userId === currentUser.id) {
            actionButtons += `<button class="edit-btn" data-index="${index}" ${isReply ? `data-reply-index="${replyIndex}"` : ''} title="ç·¨è¼¯"><i class="fas fa-pen-to-square"></i></button>`;
        }
        // ä½œè€…å¯ä»¥åˆªé™¤æ‰€æœ‰ç•™è¨€ï¼ŒéŠå®¢åªèƒ½åˆªé™¤è‡ªå·±çš„
        if (currentUser.id === 'author' || comment.userId === currentUser.id) {
            actionButtons += `<button class="delete-btn" data-index="${index}" ${isReply ? `data-reply-index="${replyIndex}"` : ''} title="åˆªé™¤"><i class="fas fa-trash-can"></i></button>`;
        }
        if (currentUser.id === 'author' && !isReply) {
            actionButtons += `<button class="reply-btn" data-index="${index}" title="å›è¦†"><i class="fas fa-reply"></i></button>`;
        }

        commentDiv.innerHTML = `
            <div class="comment-header">
              <div class="comment-info">
                <small>${comment.date}</small>
                <p class="comment-text"><strong>${comment.nickname}</strong>ï¼š${comment.text}</p>
              </div>
              <div class="comment-actions">
                ${actionButtons}
              </div>
            </div>
        `;
        
        if (!isReply) {
            const replyFormContainer = document.createElement('div');
            replyFormContainer.className = 'reply-form';
            replyFormContainer.id = `reply-form-${index}`;
            commentDiv.appendChild(replyFormContainer);
        }

        // éè¿´æ¸²æŸ“å›è¦†
        if (comment.replies && comment.replies.length > 0) {
            comment.replies.forEach((reply, i) => {
                const replyDiv = renderCommentItem(reply, index, postId, true, i);
                commentDiv.appendChild(replyDiv);
            });
        }
        
        return commentDiv;
    }

    // ç‚ºæ‰€æœ‰ç•™è¨€å’Œå›è¦†æ·»åŠ äº‹ä»¶ç›£è½å™¨
    function addCommentEventListeners(postId) {
        const container = document.getElementById('comments-container');
        
        // åˆªé™¤æŒ‰éˆ•äº‹ä»¶
        container.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const commentIndex = e.target.dataset.index;
                const replyIndex = e.target.dataset.replyIndex;

                if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡ç•™è¨€å—ï¼Ÿ')) {
                    if (replyIndex) {
                        comments[postId][commentIndex].replies.splice(replyIndex, 1);
                    } else {
                        comments[postId].splice(commentIndex, 1);
                    }
                    renderComments(postId);
                }
            });
        });

        // ç·¨è¼¯æŒ‰éˆ•äº‹ä»¶
        container.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const commentIndex = e.target.dataset.index;
                const replyIndex = e.target.dataset.replyIndex;
                const parentDiv = e.target.closest('.comment-item');
                const commentTextDiv = parentDiv.querySelector('.comment-text');

                let commentToEdit;
                if (replyIndex) {
                    commentToEdit = comments[postId][commentIndex].replies[replyIndex];
                } else {
                    commentToEdit = comments[postId][commentIndex];
                }
                const originalText = commentToEdit.text;

                const commentActionsDiv = parentDiv.querySelector('.comment-actions');
                commentActionsDiv.classList.add('hidden');

                commentTextDiv.innerHTML = `
                    <textarea class="edit-textarea">${originalText}</textarea>
                    <div class="edit-actions">
                        <button class="save-btn">å„²å­˜</button>
                        <button class="cancel-btn">å–æ¶ˆ</button>
                    </div>
                `;

                parentDiv.querySelector('.save-btn').addEventListener('click', () => {
                    const newText = parentDiv.querySelector('.edit-textarea').value.trim();
                    if (newText) {
                        if (replyIndex) {
                            comments[postId][commentIndex].replies[replyIndex].text = newText;
                        } else {
                            comments[postId][commentIndex].text = newText;
                        }
                    }
                    renderComments(postId);
                });

                parentDiv.querySelector('.cancel-btn').addEventListener('click', () => {
                    renderComments(postId);
                });
            });
        });

        // å›è¦†æŒ‰éˆ•äº‹ä»¶
        container.querySelectorAll('.reply-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const commentIndex = e.target.dataset.index;
                const replyFormContainer = document.getElementById(`reply-form-${commentIndex}`);
                
                document.querySelectorAll('.reply-form').forEach(form => form.classList.remove('active'));

                replyFormContainer.innerHTML = `
                    <input type="text" class="reply-form-nickname" value="éƒ¨è½æ ¼ä½œè€…" disabled />
                    <textarea class="reply-form-input" placeholder="å›è¦†é€™å‰‡ç•™è¨€..." rows="2"></textarea>
                    <div class="reply-form-actions">
                        <button class="reply-submit-btn">é€å‡º</button>
                        <button class="reply-cancel-btn">å–æ¶ˆ</button>
                    </div>
                `;
                replyFormContainer.classList.add('active');

                replyFormContainer.querySelector('.reply-submit-btn').addEventListener('click', () => {
                    const replyText = replyFormContainer.querySelector('.reply-form-input').value.trim();
                    if (replyText) {
                        const newReply = {
                            text: replyText,
                            date: new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' }),
                            userId: currentUser.id,
                            nickname: 'éƒ¨è½æ ¼ä½œè€…'
                        };
                        if (!comments[postId][commentIndex].replies) {
                            comments[postId][commentIndex].replies = [];
                        }
                        comments[postId][commentIndex].replies.push(newReply);
                        renderComments(postId);
                    }
                });

                replyFormContainer.querySelector('.reply-cancel-btn').addEventListener('click', () => {
                    replyFormContainer.classList.remove('active');
                    replyFormContainer.innerHTML = '';
                });
            });
        });
    }


    // æäº¤æ–°ç•™è¨€çš„å‡½å¼
    document.getElementById('submit-comment').addEventListener('click', () => {
      const postId = document.getElementById('submit-comment').dataset.postId;
      const inputElement = document.getElementById('comment-input');
      const commentText = inputElement.value.trim();
      const nicknameInput = document.getElementById('comment-nickname');

      let userNickname;
      if (currentUser.id === 'author') {
        userNickname = 'éƒ¨è½æ ¼ä½œè€…';
      } else {
        userNickname = nicknameInput.value.trim() || 'åŒ¿åéŠå®¢';
      }

      if (commentText) {
        const newComment = {
          text: commentText,
          date: new Date().toLocaleDateString('zh-TW', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
          }),
          userId: currentUser.id,
          nickname: userNickname,
          replies: []
        };
        comments[postId].push(newComment);
        inputElement.value = '';
        renderComments(postId);
      }
    });

    // ğŸ¯ ç¯©é¸æ–‡ç« é¡åˆ¥
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelector('.filter-btn.active').classList.remove('active');
        btn.classList.add('active');
        const filter = btn.dataset.filter;
        document.querySelectorAll('.card').forEach(card => {
          const match = filter === 'all' || card.dataset.category === filter;
          card.classList.toggle('hidden', !match);
        });
        grid.classList.remove('hidden');
        articleSection.classList.add('hidden');
      });
    });

    // ç•™è¨€è³‡æ–™åº«ï¼Œä½¿ç”¨ç‰©ä»¶ä¾†å„²å­˜æ¯ç¯‡æ–‡ç« çš„ç•™è¨€
    let comments = {
      1: [],
      2: [],
      3: [],
      4: []
    };

    // è™•ç†é»è®šåŠŸèƒ½çš„é€šç”¨å‡½å¼
    function toggleLike(postId) {
      const likeButtonInArticle = document.getElementById('like-button');
      const likeCountInArticle = document.getElementById('like-count');
      const cardLikeButton = document.querySelector(`.card-like-button[data-id="${postId}"]`);
      const cardLikeCount = document.querySelector(`.card-like-button[data-id="${postId}"] + .card-likes-count`);
      
      const userId = currentUser.id;

      if (currentUser.id === 'author') {
        return;
      }

      if (!likedPosts[userId]) {
        likedPosts[userId] = {};
      }

      if (likedPosts[userId][postId]) {
        // å–æ¶ˆæŒ‰è®š
        likedPosts[userId][postId] = false;
        allPostsLikes[postId]--;
      } else {
        // æŒ‰è®š
        likedPosts[userId][postId] = true;
        allPostsLikes[postId]++;
      }
      
      // æ›´æ–° posts è³‡æ–™ä¸­çš„ likes
      posts.find(p => p.id == postId).likes = allPostsLikes[postId];

      // æ›´æ–°é é¢é¡¯ç¤ºå’Œ localStorage
      if (likeCountInArticle) {
        likeCountInArticle.innerText = allPostsLikes[postId];
      }
      if (cardLikeCount) {
        cardLikeCount.innerText = allPostsLikes[postId];
      }
      
      updateLikeButtonState(postId);
      localStorage.setItem('likedPosts', JSON.stringify(likedPosts));
      localStorage.setItem('allPostsLikes', JSON.stringify(allPostsLikes));
    }

    // æ›´æ–°æŒ‰è®šæŒ‰éˆ•ç‹€æ…‹çš„å‡½å¼
    function updateLikeButtonState(postId) {
      const likeButtonInArticle = document.getElementById('like-button');
      const cardLikeButton = document.querySelector(`.card-like-button[data-id="${postId}"]`);
      const userId = currentUser.id;
      const isAuthor = currentUser.id === 'author';
      const isLiked = likedPosts[userId] && likedPosts[userId][postId];
      
      // æ›´æ–°æ–‡ç« å…§é çš„æŒ‰éˆ•ç‹€æ…‹
      if (likeButtonInArticle) {
        likeButtonInArticle.classList.toggle('liked', isLiked);
        likeButtonInArticle.classList.toggle('author-liked', isAuthor);
        likeButtonInArticle.disabled = isAuthor;
      }
      
      // æ›´æ–°å¡ç‰‡ä¸Šçš„æŒ‰éˆ•ç‹€æ…‹
      if (cardLikeButton) {
        cardLikeButton.classList.toggle('liked', isLiked);
        cardLikeButton.classList.toggle('author-liked', isAuthor);
        cardLikeButton.disabled = isAuthor;
      }
    }

    // ç‚ºæ–‡ç« å…§é çš„æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
    document.getElementById('like-button').addEventListener('click', () => {
      const postId = document.getElementById('submit-comment').dataset.postId;
      toggleLike(postId);
    });

    // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–è¨­å®š
    document.addEventListener('DOMContentLoaded', () => {
      renderCards();
      const nicknameInput = document.getElementById('comment-nickname');
      nicknameInput.value = 'éƒ¨è½æ ¼ä½œè€…';
      nicknameInput.disabled = true;
    });
  </script>
</body>
</html>
